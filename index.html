<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rotacions B√†squet</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f3f4f6; margin: 0; padding: 10px; }
  h1 { text-align: center; color: #2b4b82; }
  .container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
  .players { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; width: 100%; max-width: 900px; }
  .player { background-color: #dbeafe; border: 1px solid #60a5fa; padding: 6px; border-radius: 8px; cursor: grab; text-align: center; user-select: none; width: 160px; height: 28px; display: flex; align-items: center; justify-content: center; font-weight: 500; box-shadow: 1px 1px 4px rgba(0,0,0,0.1); transition: background-color 0.2s; }
  .player:hover { background-color: #bfdbfe; }
  .periods { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; width: 100%; max-width: 1000px; }
  .period { background-color: #ffffff; border: 2px solid #3b82f6; border-radius: 12px; min-height: 180px; padding: 8px; display: flex; flex-direction: column; align-items: center; gap: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  .period h3 { margin: 0 0 6px; font-size: 1em; color: #1d4ed8; }
  .buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
  button, select { background-color: #2563eb; color: white; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-weight: 500; }
  select { background-color: white; color: #1e3a8a; border: 1px solid #93c5fd; }
  button:hover { background-color: #1e40af; }
  .tables-wrapper { display: flex; width: 100%; justify-content: center; gap: 40px; align-items: flex-start; }
  table { border-collapse: collapse; }
  th, td { border: 1px solid #cbd5e1; padding: 6px; text-align: center; cursor: pointer; }
  th { background-color: #e0e7ff; cursor: default; }
  @media (max-width: 800px) { .tables-wrapper { flex-direction: column; gap: 20px; } }
</style>
</head>
<body>
<h1>Rotacions B√†squet</h1>
<div class="container">

  <div class="buttons">
    <button onclick="addPlayer()">‚ûï Afegir jugadora</button>
    <button onclick="resetPlayers()">üßπ Esborrar jugadores</button>
    <button onclick="clearCurrent()">üß© Buidar rotaci√≥</button>
  </div>

  <div class="buttons">
    <button onclick="saveRotation()">üíæ Desa rotaci√≥</button>
    <select id="rotationSelect"></select>
    <button onclick="loadRotation()">üìÇ Carrega rotaci√≥</button>
    <button onclick="deleteRotation()">‚ùå Elimina rotaci√≥</button>
  </div>

  <div class="players" id="players"></div>
  <div class="periods" id="periods"></div>

  <div class="tables-wrapper">
    <table id="statsTable">
      <thead>
        <tr><th>Jugadora</th><th>Per√≠odes (1-6)</th><th>Total (1-8)</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <table id="matrixTable">
      <thead>
        <tr id="matrixHeader"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
window.addEventListener("load", () => {
  const MAX_PLAYERS_PER_PERIOD = 5;
  const NUM_PERIODS = 8;
  let players = JSON.parse(localStorage.getItem("players")) || [];
  let savedRotations = JSON.parse(localStorage.getItem("savedRotations")) || {};

  function askPlayers() {
    if (players.length === 0) {
      for (let i = 1; i <= 14; i++) {
        const name = prompt(`Nom de la jugadora ${i}: (deixa buit per parar)`);
        if (!name) break;
        players.push(name.trim());
      }
      localStorage.setItem("players", JSON.stringify(players));
    }
    renderPlayers();
  }

  function renderPlayers() {
    const container = document.getElementById("players");
    container.innerHTML = "";
    players.forEach((p, index) => {
      const div = document.createElement("div");
      div.className = "player";
      div.draggable = true;
      div.textContent = p;
      div.addEventListener("dragstart", drag);
      div.addEventListener("dblclick", () => { if(confirm(`Vols eliminar ${p}?`)) { players.splice(index,1); localStorage.setItem("players",JSON.stringify(players)); renderPlayers(); updateStats(); } });
      container.appendChild(div);
    });
    updateStats();
  }

  function renderPeriods() {
    const container = document.getElementById("periods");
    container.innerHTML = "";
    for (let i = 1; i <= NUM_PERIODS; i++) {
      const div = document.createElement("div");
      div.className = "period";
      div.id = "period" + i;
      div.innerHTML = `<h3>Per√≠ode ${i}</h3>`;
      div.addEventListener("dragover", allowDrop);
      div.addEventListener("drop", drop);
      container.appendChild(div);
    }
  }

  function drag(ev) { ev.dataTransfer.setData("text", ev.target.textContent); }
  function allowDrop(ev) { ev.preventDefault(); }

  function drop(ev) {
    ev.preventDefault();
    const name = ev.dataTransfer.getData("text");
    const periodDiv = ev.currentTarget;
    if(periodDiv.querySelectorAll(".player").length >= MAX_PLAYERS_PER_PERIOD) { alert("Aquest per√≠ode ja t√© 5 jugadores."); return; }
    addPlayerToPeriod(name, periodDiv);
  }

  function addPlayerToPeriod(name, periodDiv){
    if([...periodDiv.querySelectorAll('.player')].some(d=>d.textContent===name)) return;
    const div = document.createElement('div');
    div.className='player';
    div.textContent=name;
    div.draggable=true;
    div.addEventListener('dragstart',drag);
    div.addEventListener('dblclick',()=>{ div.remove(); updateStats(); });
    periodDiv.appendChild(div);
    updateStats();
  }

  function updateStats(){
    const stats = {};
    const matrix={};
    players.forEach(p=>{ stats[p]={first6:0,total:0}; matrix[p]=Array(NUM_PERIODS).fill(''); });

    for(let i=1;i<=NUM_PERIODS;i++){
      const period=document.getElementById('period'+i);
      period.querySelectorAll('.player').forEach(d=>{
        const name=d.textContent;
        stats[name].total++; if(i<=6) stats[name].first6++;
        matrix[name][i-1]='X';
      });
    }

    const tbody=document.querySelector('#statsTable tbody'); tbody.innerHTML='';
    for(const [name,s] of Object.entries(stats)){
      const tr=document.createElement('tr'); tr.innerHTML=`<td>${name}</td><td>${s.first6}</td><td>${s.total}</td>`; tbody.appendChild(tr);
    }

    renderMatrix(matrix);
  }

  function renderMatrix(matrix){
    const header=document.getElementById('matrixHeader');
    header.innerHTML=`<th>Jugadora</th>${[...Array(NUM_PERIODS).keys()].map(i=>`<th>${i+1}</th>`).join('')}`;
    const tbody=document.querySelector('#matrixTable tbody'); tbody.innerHTML='';
    for(const p of players){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${p}</td>`+matrix[p].map((x,i)=>`<td data-player='${p}' data-period='${i+1}'>${x}</td>`).join('');
      tbody.appendChild(tr);
    }
    document.querySelectorAll('#matrixTable td[data-player]').forEach(td=>{
      td.onclick=()=>{
        const pname=td.getAttribute('data-player');
        const period=parseInt(td.getAttribute('data-period'));
        const periodDiv=document.getElementById('period'+period);
        if(td.textContent===''){ // afegeix
          if(periodDiv.querySelectorAll('.player').length>=MAX_PLAYERS_PER_PERIOD){ alert('Aquest per√≠ode ja t√© 5 jugadores.'); return; }
          addPlayerToPeriod(pname, periodDiv);
        } else { // treu
          [...periodDiv.querySelectorAll('.player')].find(d=>d.textContent===pname)?.remove();
          updateStats();
        }
      };
    });
  }

  // Funcions existents: saveRotation, loadRotation, deleteRotation, clearCurrent, addPlayer, resetPlayers
  function saveRotation(){ const name=prompt('Nom de la rotaci√≥:'); if(!name)return; const data={}; for(let i=1;i<=NUM_PERIODS;i++){ data[i]=[...document.querySelectorAll(`#period${i} .player`)].map(d=>d.textContent); } savedRotations[name]=data; localStorage.setItem('savedRotations',JSON.stringify(savedRotations)); populateRotationSelect(); alert(`Rotaci√≥ "${name}" desada!`); }
  function loadRotation(){ const name=document.getElementById('rotationSelect').value; if(!name || !savedRotations[name]) return alert('Selecciona una rotaci√≥ v√†lida.'); renderPeriods(); const data=savedRotations[name]; for(let i=1;i<=NUM_PERIODS;i++){ const div=document.getElementById('period'+i); (data[i]||[]).forEach(n=>{ addPlayerToPeriod(n,div); }); } updateStats(); }
  function deleteRotation(){ const name=document.getElementById('rotationSelect').value; if(!name)return alert('Cap rotaci√≥ seleccionada.'); if(confirm(`Vols eliminar la rotaci√≥ "${name}"?`)){ delete savedRotations[name]; localStorage.setItem('savedRotations',JSON.stringify(savedRotations)); populateRotationSelect(); } }
  function clearCurrent(){ if(confirm('Vols buidar totes les posicions actuals?')){ renderPeriods(); updateStats(); } }
  function populateRotationSelect(){ const select=document.getElementById('rotationSelect'); select.innerHTML="<option value=''>‚Äî Selecciona rotaci√≥ ‚Äî</option>"; for(const name of Object.keys(savedRotations)){ const opt=document.createElement('option'); opt.value=name; opt.textContent=name; select.appendChild(opt); } }
  function resetPlayers(){ if(confirm('Vols esborrar totes les jugadores guardades?')){ localStorage.removeItem('players'); players=[]; document.getElementById('players').innerHTML=''; askPlayers(); } }
  function addPlayer(){ const newName=prompt('Nom de la nova jugadora:'); if(newName && !players.includes(newName.trim())){ players.push(newName.trim()); localStorage.setItem('players',JSON.stringify(players)); renderPlayers(); } else if(players.includes(newName.trim())) alert('Aquesta jugadora ja existeix!'); }

  window.addPlayer=addPlayer; window.resetPlayers=resetPlayers; window.saveRotation=saveRotation; window.loadRotation=loadRotation; window.deleteRotation=deleteRotation; window.clearCurrent=clearCurrent;

  renderPeriods(); populateRotationSelect(); askPlayers();
});
</script>
</body>
</html>
